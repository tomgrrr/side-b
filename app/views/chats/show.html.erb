<div class="chat-v1">

  <%= turbo_stream_from @chat %>

  <div class="chat-sidebar">
    <div class="sidebar-header">
      <span class="sidebar-title">Conversations</span>
      <%= link_to "+", chats_path, data: { turbo_method: :post }, class: "new-chat-btn" %>
    </div>

    <div class="chat-list">
      <% current_user.chats.order(updated_at: :desc).each do |chat| %>
        <div class="chat-item <%= 'active' if chat == @chat %>">
          <%= link_to chat_path(chat), class: "chat-item-link" do %>
            <span class="chat-item-title"><%= chat.title %></span>
          <% end %>
          <%= link_to chat_path(chat), data: { turbo_method: :delete, turbo_confirm: "Delete this convo ?" }, class: "chat-item-delete" do %>
            Ã—
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Zone principale du chat -->
  <div class="main-chat">
    <!-- Header -->
    <div class="chat-header">
      <div class="ai-avatar">ðŸŽµ</div>
      <div class="chat-title-area">
        <h2><%= @chat.title %></h2>
        <p>Your personal expert !</p>
      </div>
    </div>

    <!-- Zone des messages -->
    <div class="messages-area" id="messages">
      <% if @chat.messages.empty? %>
        <div class="message assistant">
          Hello, I'm your Vinyl expert, ask me whatever you want !
        </div>
      <% else %>
        <% @chat.messages.each do |message| %>
          <%= render partial: "messages/message", locals: { message: message } %>
        <% end %>
      <% end %>
    </div>

    <!-- Zone de saisie -->
    <div class="input-area">
      <%= simple_form_for [@chat, @message], html: { class: 'chat-form', id: 'new_message' } do |f| %>
        <div class="input-wrapper">
          <%= f.input :content,
              as: :string,
              label: false,
              required: true,
              placeholder: "Ask me anything about vinyls...",
              wrapper: false,
              input_html: { class: 'chat-input', autocomplete: 'off' } %>
          <%= f.button :submit, 'â†’', class: 'send-btn' %>
        </div>
      <% end %>
    </div>
  </div>
</div>
